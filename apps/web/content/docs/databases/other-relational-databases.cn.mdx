---
title: 其他关系型数据库
description: 通过 Kysely 在 AgentStart 中使用其他关系型数据库
---

# 其他关系型数据库

AgentStart 支持 Kysely 支持的任何数据库。这包括官方文档之外的许多关系型数据库。

## 支持的数据库

通过 Kysely，AgentStart 可以与以下数据库配合使用：

- PostgreSQL
- MySQL
- SQLite
- MS SQL Server
- **任何具有 Kysely 方言的数据库**

## 自定义 Kysely 方言

您可以使用任何自定义 Kysely 方言连接到您的数据库：

```ts title="lib/agent.ts"
import { agentStart } from "agentstart";
import { Kysely } from "kysely";
import { kyselyAdapter } from "agentstart/db";
import { YourCustomDialect } from "your-dialect-package";

const db = new Kysely({
  dialect: new YourCustomDialect({
    // 您的方言配置
  }),
});

export const start = agentStart({
  agent,
  memory: kyselyAdapter(db),
});
```

## 社区方言

Kysely 社区为各种数据库维护方言：

### CockroachDB

```bash
npm install kysely @cockroachdb/kysely-adapter
```

```ts
import { CockroachDialect } from "@cockroachdb/kysely-adapter";

const db = new Kysely({
  dialect: new CockroachDialect({
    connectionString: process.env.DATABASE_URL,
  }),
});
```

### PlanetScale

```bash
npm install kysely @planetscale/database
```

```ts
import { PlanetScaleDialect } from "@planetscale/database";

const db = new Kysely({
  dialect: new PlanetScaleDialect({
    url: process.env.DATABASE_URL,
  }),
});
```

### Cloudflare D1

```bash
npm install kysely @cloudflare/d1-dialect
```

```ts
import { D1Dialect } from "@cloudflare/d1-dialect";

const db = new Kysely({
  dialect: new D1Dialect({
    database: env.DB, // Cloudflare Workers 绑定
  }),
});
```

## 架构要求

无论使用哪个数据库，AgentStart 都需要这些表：

### Threads 表

```sql
CREATE TABLE threads (
  id TEXT PRIMARY KEY,
  title TEXT,
  user_id TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  metadata JSON
);
```

### Messages 表

```sql
CREATE TABLE messages (
  id TEXT PRIMARY KEY,
  thread_id TEXT REFERENCES threads(id),
  role TEXT,
  content TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  metadata JSON
);
```

## 使用 CLI

AgentStart CLI 可以为 Kysely 生成架构：

```bash
npx @agentstart/cli generate
```

这将创建一个 SQL 文件，您可以查看并应用到数据库。

## 类型安全

为完全类型安全定义数据库类型：

```ts
interface Database {
  threads: {
    id: string;
    title: string | null;
    user_id: string | null;
    created_at: Date;
    metadata: unknown;
  };
  messages: {
    id: string;
    thread_id: string;
    role: string;
    content: string;
    created_at: Date;
    metadata: unknown;
  };
}

const db = new Kysely<Database>({
  dialect: new YourDialect({
    // 配置
  }),
});
```

## 迁移工具

对于架构迁移，使用您数据库的首选迁移工具：

- **Kysely Migrations** - 内置迁移系统
- **数据库特定工具** - pg_migrate、mysql-migrate 等
- **ORM 迁移** - 如果与 Kysely 一起使用 Drizzle 或 Prisma

## 需要帮助？

如果您使用的数据库未在此处列出：

1. 检查 [Kysely 是否支持它](https://kysely.dev/docs/dialects)
2. 寻找社区方言
3. 在 GitHub 上开启 issue 以获得官方支持

## 下一步

<Cards>
  <Card title="PostgreSQL" href="/docs/databases/postgresql" />
  <Card title="MySQL" href="/docs/databases/mysql" />
  <Card title="SQLite" href="/docs/databases/sqlite" />
</Cards>
