---
title: PostgreSQL
description: 将 AgentStart 与 PostgreSQL 集成
---

# PostgreSQL

PostgreSQL 是一个强大的开源关系型数据库管理系统，以其高级功能、可扩展性以及对复杂查询和大型数据集的支持而闻名。

## 使用示例

确保您已安装并配置了 PostgreSQL。然后，您可以使用 Kysely 的 PostgreSQL 方言直接连接到 AgentStart。

```ts title="lib/agent.ts"
import { agentStart } from "agentstart";
import { Kysely, PostgresDialect } from "kysely";
import { Pool } from "pg";

const db = new Kysely({
  dialect: new PostgresDialect({
    pool: new Pool({
      connectionString: process.env.DATABASE_URL,
    }),
  }),
});

export const start = agentStart({
  agent,
  memory: kyselyAdapter(db, {
    type: "postgres", // 可选配置
  }),
});
```

<Callout>
  有关更多信息，请阅读 Kysely 关于
  [PostgresDialect](https://kysely-org.github.io/kysely-apidoc/classes/PostgresDialect.html) 的文档。
</Callout>

## 架构生成和迁移

AgentStart CLI 允许您根据配置生成或迁移数据库架构。

<table>
  <tr className="border-b">
    <th>
      <p className="font-bold text-[16px] mb-1">PostgreSQL 架构生成</p>
    </th>
    <th>
      <p className="font-bold text-[16px] mb-1">PostgreSQL 架构迁移</p>
    </th>
  </tr>
  <tr className="h-10">
    <td>✅ 支持</td>
    <td>✅ 支持</td>
  </tr>
</table>

```bash title="架构生成"
npx @agentstart/cli generate
```

```bash title="架构迁移"
npx @agentstart/cli migrate
```

## 使用 Drizzle

为了获得更好的开发体验，我们推荐使用提供类型安全查询和迁移的 [Drizzle 适配器](/docs/databases/drizzle)。

```bash
npm install drizzle-orm @neondatabase/serverless
```

```ts title="lib/agent.ts"
import { drizzle } from "drizzle-orm/neon-http";
import { neon } from "@neondatabase/serverless";
import { drizzleAdapter } from "agentstart/db";

const sql = neon(process.env.DATABASE_URL!);
const db = drizzle(sql);

export const start = agentStart({
  agent,
  memory: drizzleAdapter(db, {
    provider: "pg",
    schema: {
      thread: threadsTable,
      message: messagesTable,
    },
  }),
});
```

## 连接字符串格式

```bash
DATABASE_URL=postgresql://user:password@localhost:5432/dbname
```

对于云提供商：

```bash
# Neon
DATABASE_URL=postgresql://user:password@ep-xxx.us-east-2.aws.neon.tech/neondb

# Supabase
DATABASE_URL=postgresql://postgres:password@db.xxx.supabase.co:5432/postgres

# Railway
DATABASE_URL=postgresql://postgres:password@containers-us-west-xxx.railway.app:5432/railway
```

## 其他信息

PostgreSQL 通过 [Kysely](https://kysely.dev/) 适配器支持。Kysely 支持的任何数据库也都会被支持。有关更多信息，请参阅[其他关系型数据库](/docs/databases/other-relational-databases)。

## 下一步

<Cards>
  <Card title="Drizzle 适配器" href="/docs/databases/drizzle" />
  <Card title="MySQL" href="/docs/databases/mysql" />
  <Card title="SQLite" href="/docs/databases/sqlite" />
</Cards>
