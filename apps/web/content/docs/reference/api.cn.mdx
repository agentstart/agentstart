---
title: API 参考
description: AgentStart 的完整 API 参考
---

# API 参考

AgentStart 所有 API 的完整参考。

## 核心 API

### agentStart()

创建具有处理器和 API 的 AgentStart 实例。

```ts
function agentStart(options: AgentStartOptions): AgentStartInstance
```

**参数：**

```ts
interface AgentStartOptions {
  agent: Agent;
  memory: Adapter;
  appName?: string;
  basePath?: string;
  middleware?: Middleware[];
  getUserId?: (headers: Headers) => string | Promise<string>;
}
```

**返回：**

```ts
interface AgentStartInstance {
  handler: Handler; // oRPC 处理器
  api: {
    thread: ThreadAPI;
    message: MessageAPI;
    todo: TodoAPI;
  };
}
```

**示例：**

```ts
import { agentStart } from "agentstart";

export const start = agentStart({
  agent,
  memory: drizzleAdapter(db, { provider: "pg", schema }),
  appName: "my-app",
  basePath: "/api/agent",
});
```

## Agent 类

### new Agent()

创建 AI 智能体实例。

```ts
class Agent<TContext = unknown> {
  constructor(options: AgentOptions<TContext>)
}
```

**参数：**

```ts
interface AgentOptions<TContext> {
  model: LanguageModel;
  instructions: string;
  tools?: Record<string, Tool>;
  context?: TContext;
  streamOptions?: StreamOptions;
}
```

**示例：**

```ts
import { Agent, innerTools, osTools } from "agentstart/agent";

const agent = new Agent({
  model: openrouter("x-ai/grok-4-fast"),
  instructions: "你是一个乐于助人的助手。",
  tools: {
    ...innerTools,
    ...osTools,
  },
});
```

## Thread API

### thread.create()

创建新的对话线程。

```ts
thread.create(params?: CreateThreadParams): Promise<Thread>
```

**参数：**

```ts
interface CreateThreadParams {
  title?: string;
  userId?: string;
  metadata?: unknown;
}
```

**返回：**

```ts
interface Thread {
  id: string;
  title: string | null;
  userId: string | null;
  createdAt: Date;
  metadata: unknown;
}
```

**示例：**

```ts
const thread = await start.api.thread.create({
  title: "TypeScript 帮助",
  userId: "user-123",
});
```

### thread.get()

获取特定线程。

```ts
thread.get(params: { id: string }): Promise<Thread>
```

### thread.list()

列出所有线程。

```ts
thread.list(params?: ListThreadsParams): Promise<Thread[]>
```

**参数：**

```ts
interface ListThreadsParams {
  userId?: string;
  limit?: number;
  offset?: number;
}
```

### thread.delete()

删除线程。

```ts
thread.delete(params: { id: string }): Promise<void>
```

## Message API

### message.send()

向线程发送消息。

```ts
message.send(params: SendMessageParams): Promise<void>
```

**参数：**

```ts
interface SendMessageParams {
  threadId: string;
  content: string;
}
```

**示例：**

```ts
await start.api.message.send({
  threadId: "thread-123",
  content: "什么是 TypeScript？",
});
```

### message.list()

列出线程中的消息。

```ts
message.list(params: { threadId: string }): Promise<Message[]>
```

**返回：**

```ts
interface Message {
  id: string;
  threadId: string;
  role: "user" | "assistant" | "system" | "tool";
  content: string;
  createdAt: Date;
  metadata: unknown;
}
```

## Todo API

### todo.read()

读取线程的 todos。

```ts
todo.read(params: { threadId: string }): Promise<Todo[]>
```

**返回：**

```ts
interface Todo {
  id: string;
  content: string;
  status: "pending" | "in_progress" | "completed";
  priority: "low" | "medium" | "high";
}
```

### todo.write()

更新线程的 todos。

```ts
todo.write(params: WriteTodoParams): Promise<void>
```

**参数：**

```ts
interface WriteTodoParams {
  threadId: string;
  todos: Todo[];
}
```

## 数据库适配器

### drizzleAdapter()

Drizzle ORM 适配器。

```ts
function drizzleAdapter(
  db: DrizzleDB,
  config: DrizzleAdapterConfig
): Adapter
```

**配置：**

```ts
interface DrizzleAdapterConfig {
  provider: "pg" | "mysql" | "sqlite";
  schema: {
    thread: DrizzleTable;
    message: DrizzleTable;
  };
}
```

**示例：**

```ts
import { drizzleAdapter } from "agentstart/db";

const adapter = drizzleAdapter(db, {
  provider: "pg",
  schema: {
    thread: threadsTable,
    message: messagesTable,
  },
});
```

### prismaAdapter()

Prisma ORM 适配器。

```ts
function prismaAdapter(
  prisma: PrismaClient,
  config: PrismaConfig
): Adapter
```

**配置：**

```ts
interface PrismaConfig {
  provider: "postgresql" | "mysql" | "sqlite" | "mongodb";
}
```

**示例：**

```ts
import { prismaAdapter } from "agentstart/db";

const adapter = prismaAdapter(prisma, {
  provider: "postgresql",
});
```

### kyselyAdapter()

Kysely 查询构建器适配器。

```ts
function kyselyAdapter(
  db: Kysely<any>,
  config?: KyselyAdapterConfig
): Adapter
```

**配置（可选）：**

```ts
interface KyselyAdapterConfig {
  type?: "postgres" | "mysql" | "sqlite" | "mssql";
}
```

**示例：**

```ts
import { kyselyAdapter } from "agentstart/db";

const adapter = kyselyAdapter(db, {
  type: "postgres",
});
```

### mongodbAdapter()

MongoDB 适配器。

```ts
function mongodbAdapter(db: Db): Adapter
```

**示例：**

```ts
import { mongodbAdapter } from "agentstart/db";

const adapter = mongodbAdapter(db);
```

## 客户端 API

### createAgentClient()

为浏览器创建类型安全的客户端。

```ts
function createAgentClient(options?: ClientOptions): AgentClient
```

**选项：**

```ts
interface ClientOptions {
  baseURL?: string;
  fetch?: typeof fetch;
}
```

**返回：**

```ts
interface AgentClient {
  client: {
    thread: {
      create: () => Promise<Thread>;
      list: () => Promise<Thread[]>;
      delete: (params: { id: string }) => Promise<void>;
    };
    todo: {
      read: (params: { threadId: string }) => Promise<Todo[]>;
    };
  };
  useThread: (threadId: string) => void;
}
```

**示例：**

```ts
import { createAgentClient } from "agentstart/client";

export const { client, useThread } = createAgentClient({
  baseURL: "http://localhost:3000",
});
```

### useAgentStore()

使用 Zustand 访问智能体状态。

```ts
function useAgentStore<T>(
  selector: (state: AgentState) => T,
  threadId: string
): T
```

**状态：**

```ts
interface AgentState {
  thread: Thread | null;
  messages: Message[];
  isLoading: boolean;
  isStreaming: boolean;
  error: Error | null;
  sendMessage: (params: { content: string }) => Promise<void>;
  regenerate: () => Promise<void>;
  stop: () => void;
}
```

**示例：**

```tsx
import { useAgentStore } from "agentstart/client";

const messages = useAgentStore((state) => state.messages, threadId);
const sendMessage = useAgentStore((state) => state.sendMessage, threadId);
```

## 工具

### innerTools

内置任务管理工具。

```ts
const innerTools: {
  todoRead: Tool;
  todoWrite: Tool;
}
```

### osTools

操作系统和文件工具。

```ts
const osTools: {
  bash: Tool;
  read: Tool;
  write: Tool;
  update: Tool;
  glob: Tool;
  grep: Tool;
  ls: Tool;
}
```

### 自定义工具

使用 Zod 架构创建自定义工具。

```ts
interface Tool {
  description: string;
  parameters: ZodSchema;
  execute: (params: unknown, context?: unknown) => Promise<unknown>;
}
```

**示例：**

```ts
import { z } from "zod";

const weatherTool = {
  description: "获取当前天气",
  parameters: z.object({
    location: z.string(),
    units: z.enum(["celsius", "fahrenheit"]),
  }),
  execute: async ({ location, units }) => {
    // 实现
    return { temperature: 72, units };
  },
};
```

## 集成处理器

### toNextJsHandler()

将处理器转换为 Next.js App Router 格式。

```ts
function toNextJsHandler(handler: Handler): {
  GET: RouteHandler;
  POST: RouteHandler;
}
```

**示例：**

```ts
import { toNextJsHandler } from "agentstart/integration";

export const { POST, GET } = toNextJsHandler(start.handler);
```

### toNodeHandler()

将处理器转换为 Node.js HTTP 格式。

```ts
function toNodeHandler(
  handler: Handler
): (req: IncomingMessage, res: ServerResponse) => Promise<void>
```

**示例：**

```ts
import { toNodeHandler } from "agentstart/integration";
import { createServer } from "node:http";

const httpHandler = toNodeHandler(start.handler);
createServer(httpHandler).listen(3000);
```

## 类型导出

### 常用类型

```ts
import type {
  Agent,
  Thread,
  Message,
  Todo,
  Tool,
  Adapter,
  AgentStartOptions,
} from "agentstart";
```

## 下一步

<Cards>
  <Card title="基本用法" href="/docs/basic-usage" />
  <Card title="TypeScript" href="/docs/concepts/typescript" />
  <Card title="Next.js 集成" href="/docs/integrations/next" />
</Cards>
