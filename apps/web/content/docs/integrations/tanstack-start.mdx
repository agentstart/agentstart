---
title: TanStack Start Integration
description: Integrate AgentStart with TanStack Start file-based routes
---

AgentStart runs cleanly inside TanStack Start. Here’s how to mount the agent handler, share the client, and sync router state with file-based routes.

Before you start, make sure you have an AgentStart instance configured. If you haven't done that yet, check out the [installation](/docs/installation).

### Create API Route

Expose the agent handler through a file-based API route. Keep the path at `/api/agent/$` so generated clients and hooks continue to work.

```ts title="src/routes/api/agent/$.ts"
import { createFileRoute } from "@tanstack/react-router";
import { start } from "@/lib/agent";

export const Route = createFileRoute("/api/agent/$")({
  server: {
    handlers: {
      GET: async ({ request }) => start.handler(request),
      POST: async ({ request }) => start.handler(request),
    },
  },
});
```

### Create a client

Create a client instance the same way you would for Next.js. This gives you `client`, `useThread`, and store selectors.

```ts title="src/lib/agent-client.ts"
import {
  createAgentClient,
  useAgentStore,
  useThreadStore,
} from "agentstart/client";

export const { client, useThread } = createAgentClient();

export { useAgentStore, useThreadStore };
```

### Wrap the provider with router state

Wire the AgentStart provider to TanStack Router so navigation and thread IDs stay in sync.

```tsx title="src/components/provider.tsx"
import { useParams, useRouter } from "@tanstack/react-router";
import { AgentStartProvider } from "agentstart/client";
import type React from "react";
import { client } from "@/lib/agent-client";

interface ProviderProps {
  children?: React.ReactNode;
}

export function Provider({ children }: ProviderProps) {
  const router = useRouter();
  const { threadId } = useParams({ strict: false });

  return (
    <AgentStartProvider
      defaultTheme="light"
      client={client}
      navigate={(path) => router.navigate({ to: path })}
      getThreadId={() => threadId}
    >
      {children}
    </AgentStartProvider>
  );
}
```

### Call server actions with `start.api`

Use TanStack Start’s `createServerFn` to call `start.api` methods on the server and feed loaders with typed data.

```ts title="src/routes/thread/$threadId.tsx"
import { createFileRoute } from "@tanstack/react-router";
import { createServerFn } from "@tanstack/react-start";
import { start } from "@/lib/agent";

const getThreadData = createServerFn()
  .inputValidator((input: { threadId: string }) => input)
  .handler(async ({ data }) => {
    const { threadId } = data;
    const [{ thread }, messages] = await Promise.all([
      start.api.thread.get({ threadId }),
      start.api.message.get({ threadId }),
    ]);

    return { thread, messages };
  });

export const Route = createFileRoute("/thread/$threadId")({
  loader: ({ params }) => getThreadData({ data: { threadId: params.threadId } }),
  component: ThreadPage,
});

function ThreadPage() {
  const { threadId } = Route.useParams();
  const { thread, messages } = Route.useLoaderData();

  // Render your thread UI with initial data
}
```

That’s it—TanStack Start apps reuse the same AgentStart building blocks as Next.js. Layer on styling, blob uploads, and custom tools as needed.
