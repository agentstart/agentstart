---
title: 核心概念
description: 理解 AgentStart 的基本构建模块
---

# 核心概念

AgentStart 围绕几个关键概念构建，这些概念协同工作以创建强大的 AI 智能体。

## Agent 类

Agent 类使用 AI SDK 协调模型执行、工具调用和消息流式传输。

```ts
import { Agent, innerTools, osTools } from "agentstart/agent";
import { createOpenRouter } from "@openrouter/ai-sdk-provider";

const openrouter = createOpenRouter({
  apiKey: process.env.MODEL_PROVIDER_API_KEY,
});

const agent = new Agent({
  model: openrouter("x-ai/grok-4-fast"),
  instructions: "你是一个乐于助人的助手。",
  tools: {
    ...innerTools,
    ...osTools,
  },
});
```

### 构造函数选项

- **model**: 来自 AI SDK 提供商的语言模型
- **instructions**: 定义智能体行为的系统提示
- **tools**: 工具函数对象
- **agentsMDPrompt** (可选): 额外的 Markdown 上下文
- **context** (可选): 工具可用的自定义上下文

## agentStart 函数

`agentStart()` 函数创建一个 oRPC 处理器，将您的智能体暴露为 REST API。

```ts
import { agentStart } from "agentstart";
import { drizzleAdapter } from "agentstart/db";

export const start = agentStart({
  agent,
  memory: drizzleAdapter(db, {
    provider: "pg",
    schema,
  }),
  appName: "my-app",
});
```

### 选项

- **agent**: Agent 实例（必需）
- **memory**: 用于持久化的数据库适配器（必需）
- **appName**: 应用程序标识符
- **basePath**: API 基础路径（默认：`/api/agent`）
- **sandbox**: 代码执行的沙箱配置
- **middleware**: oRPC 中间件数组

## 工具

工具通过可执行函数扩展智能体的能力。

### 内置工具

AgentStart 提供两类工具：

**innerTools** - 任务管理：
- `todoRead`: 读取任务列表
- `todoWrite`: 更新任务列表

**osTools** - 文件系统和 Shell：
- `bash`: 执行 Shell 命令
- `read`: 读取文件内容
- `write`: 写入文件
- `update`: 更新文件部分
- `glob`: 按模式搜索文件
- `grep`: 搜索文件内容
- `ls`: 列出目录内容

### 使用方法

```ts
import { innerTools, osTools } from "agentstart/agent";

const agent = new Agent({
  model,
  instructions,
  tools: {
    ...innerTools,
    ...osTools,
    // 添加自定义工具
    myTool: {
      description: "我的自定义工具",
      parameters: z.object({
        input: z.string(),
      }),
      execute: async ({ input }) => {
        return `已处理: ${input}`;
      },
    },
  },
});
```

## 数据库适配器

数据库适配器持久化智能体对话和元数据。

### Drizzle 适配器

```ts
import { drizzleAdapter } from "agentstart/db";
import { drizzle } from "drizzle-orm/neon-http";

const db = drizzle(process.env.DATABASE_URL!);

const memory = drizzleAdapter(db, {
  provider: "pg",
  schema: {
    thread: threadsTable,
    message: messagesTable,
    // ... 其他表
  },
});
```

### 支持的提供商

- PostgreSQL (`pg`)
- MySQL (`mysql`)
- SQLite (`sqlite`)

其他可用适配器：
- Prisma: `prismaAdapter`
- Kysely: `kyselyAdapter`
- MongoDB: `mongodbAdapter`
- In-Memory: `memoryAdapter`

## 客户端集成

为您的 React UI 创建类型安全的客户端。

```ts
// lib/agent-client.ts
import { createAgentClient } from "agentstart/client";

export const { client, useThread } = createAgentClient();
```

### 在组件中使用

```tsx
import { useThread } from "@/lib/agent-client";

export function ChatPage() {
  const { threadId } = useParams<{ threadId: string }>();
  useThread(threadId);

  return <Conversation />;
}
```

## 框架集成

### Next.js

```ts
// app/api/agent/[...all]/route.ts
import { toNextJsHandler } from "agentstart/integration";
import { start } from "@/lib/agent";

export const { POST, GET } = toNextJsHandler(start.handler);
```

### Node.js

```ts
import { toNodeHandler } from "agentstart/integration";
import { start } from "./agent";

const handler = toNodeHandler(start.handler);

// Express
app.use("/api/agent", handler);

// Node HTTP
createServer(handler).listen(3000);
```

## 下一步

<Cards>
  <Card title="工具指南" href="/docs/concepts/tools" />
  <Card title="数据库" href="/docs/concepts/database" />
  <Card title="API 参考" href="/docs/reference/api" />
</Cards>
