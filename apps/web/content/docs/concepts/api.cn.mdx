---
title: API
description: AgentStart API 使用
---

# API

当您使用 `agentStart()` 创建 AgentStart 实例时，它会提供一个 `api` 对象，该对象公开智能体实例中的每个端点。您可以使用它在服务器端与 AgentStart 进行交互。

## 在服务器上调用 API 端点

要在服务器上调用 API 端点，请导入您的 `start` 实例并使用 `api` 对象调用端点：

```ts title="lib/agent.ts"
import { agentStart } from "agentstart";

export const start = agentStart({
  agent,
  memory,
  appName: "my-app",
});

// 在服务器上调用端点
await start.api.thread.list();
await start.api.thread.get({ id: "thread-123" });
await start.api.message.send({ threadId: "thread-123", content: "你好" });
```

## 可用端点

### 线程管理

```ts
// 列出所有线程
const threads = await start.api.thread.list();

// 获取特定线程
const thread = await start.api.thread.get({ id: "thread-123" });

// 创建新线程
const newThread = await start.api.thread.create({ 
  title: "我的线程" 
});

// 删除线程
await start.api.thread.delete({ id: "thread-123" });
```

### 消息操作

```ts
// 发送消息
const response = await start.api.message.send({
  threadId: "thread-123",
  content: "什么是 TypeScript？",
});

// 获取消息
const messages = await start.api.message.list({ 
  threadId: "thread-123" 
});
```

### Todo 管理

```ts
// 读取 todos
const todos = await start.api.todo.read({ threadId: "thread-123" });

// 写入 todos
await start.api.todo.write({
  threadId: "thread-123",
  todos: [
    { id: "1", content: "任务 1", status: "pending", priority: "high" },
    { id: "2", content: "任务 2", status: "completed", priority: "medium" },
  ],
});
```

## 在 API 路由中使用

<Tabs items={["Next.js", "Node.js"]}>
  <Tab value="Next.js">
    ```ts title="app/api/threads/route.ts"
    import { start } from "@/lib/agent";

    export async function GET() {
      const threads = await start.api.thread.list();
      return Response.json(threads);
    }

    export async function POST(request: Request) {
      const body = await request.json();
      const thread = await start.api.thread.create(body);
      return Response.json(thread);
    }
    ```
  </Tab>
  
  <Tab value="Node.js">
    ```ts title="server.ts"
    import express from "express";
    import { start } from "./lib/agent";

    const app = express();

    app.get("/api/threads", async (req, res) => {
      const threads = await start.api.thread.list();
      res.json(threads);
    });

    app.post("/api/threads", async (req, res) => {
      const thread = await start.api.thread.create(req.body);
      res.json(thread);
    });
    ```
  </Tab>
</Tabs>

## 类型安全

`api` 对象完全类型化，提供自动完成和类型检查：

```ts
// ✅ TypeScript 知道返回类型
const thread = await start.api.thread.get({ id: "123" });
//    ^? Thread

// ❌ TypeScript 错误：缺少必需参数
await start.api.thread.get();

// ❌ TypeScript 错误：参数类型错误
await start.api.thread.get({ id: 123 });
```

## 错误处理

API 调用可能会抛出需要处理的错误：

```ts
try {
  const thread = await start.api.thread.get({ id: threadId });
} catch (error) {
  if (error.code === "NOT_FOUND") {
    // 处理线程未找到
  }
  throw error;
}
```

## 下一步

<Cards>
  <Card title="客户端" href="/docs/concepts/client" />
  <Card title="CLI" href="/docs/concepts/cli" />
</Cards>
