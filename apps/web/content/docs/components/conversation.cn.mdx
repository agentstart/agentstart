---
title: Conversation
description: 显示带流式传输支持的线程消息
---

# Conversation

`Conversation` 组件显示线程中的消息，支持自动滚动、流式传输和工具可视化。

<ConversationDemo />

## 安装

```bash
npx shadcn@latest add conversation --registry=@agentstart
```

## 使用

```tsx
import { Conversation } from "@/components/agent/conversation";
import { useThread } from "agentstart/client";

export default function ChatPage({ threadId }: { threadId: string }) {
  useThread(threadId); // 订阅线程更新

  return <Conversation threadId={threadId} />;
}
```

## Props

| 名称 | 类型 | 必需 | 描述 |
|------|------|------|------|
| `threadId` | `string` | - | 要显示消息的线程 ID。如果未提供，使用 'default' 存储。 |
| `className` | `string` | - | 对话容器的额外 CSS 类 |
| `emptyState` | `ReactNode` | - | 没有消息时显示的自定义组件 |
| `loadingState` | `ReactNode` | - | 加载消息时显示的自定义组件 |
| `errorState` | `(error: Error, retry: () => void) => ReactNode` | - | 带重试函数的自定义错误渲染器 |

## 功能

- **自动滚动** - 自动滚动到最新消息
- **流式传输** - 通过 SSE 实时消息流式传输
- **工具可视化** - 渲染工具执行结果
- **加载状态** - 内置加载和错误状态
- **消息操作** - 复制和重新生成消息操作

## 示例

### 基本用法

```tsx
import { Conversation } from "@/components/agent/conversation";

export default function ThreadPage({ threadId }: { threadId: string }) {
  return (
    <div className="h-screen">
      <Conversation threadId={threadId} />
    </div>
  );
}
```

### 自定义空状态

```tsx
import { Conversation } from "@/components/agent/conversation";

export default function ThreadPage({ threadId }: { threadId: string }) {
  return (
    <Conversation
      threadId={threadId}
      emptyState={
        <div className="flex flex-col items-center justify-center h-full">
          <h2 className="text-2xl font-bold">开始对话</h2>
          <p className="text-muted-foreground">发送消息开始</p>
        </div>
      }
    />
  );
}
```

### 自定义错误状态

```tsx
import { Conversation } from "@/components/agent/conversation";

export default function ThreadPage({ threadId }: { threadId: string }) {
  return (
    <Conversation
      threadId={threadId}
      errorState={(error, retry) => (
        <div className="flex flex-col items-center justify-center h-full gap-4">
          <p className="text-destructive">{error.message}</p>
          <button onClick={retry} className="px-4 py-2 bg-primary text-white rounded">
            重试
          </button>
        </div>
      )}
    />
  );
}
```

### 自定义样式

```tsx
import { Conversation } from "@/components/agent/conversation";

export default function ThreadPage({ threadId }: { threadId: string }) {
  return (
    <Conversation
      threadId={threadId}
      className="bg-slate-50 dark:bg-slate-900 rounded-lg p-4"
    />
  );
}
```

## 消息操作

对话包含每条消息的内置操作：

- **复制** - 将消息内容复制到剪贴板
- **重新生成** - 重新生成最后一条助手消息

```tsx
// 操作自动包含
<Conversation threadId={threadId} />
```

## 工具渲染

对话自动渲染工具执行结果：

```tsx
// bash、read、write 等工具会自动可视化
<Conversation threadId={threadId} />
```

## 滚动行为

对话包含智能滚动：

- **自动滚动** - 新消息时滚动到底部
- **滚动按钮** - 不在底部时显示滚动到底部按钮
- **手动控制** - 用户可以自由滚动而不受干扰

## 与 useThread 集成

对话与 `useThread` hook 配合使用以实现实时更新：

```tsx
import { Conversation } from "@/components/agent/conversation";
import { useThread } from "agentstart/client";

export default function ThreadPage({ threadId }: { threadId: string }) {
  // 订阅实时更新
  useThread(threadId);

  return <Conversation threadId={threadId} />;
}
```

## 消息结构

消息显示包括：

- **角色指示器** - User、Assistant、System 或 Tool
- **时间戳** - 消息创建时间
- **内容** - 支持 markdown 的消息文本
- **工具结果** - 工具输出的可视化渲染
- **操作** - 复制和重新生成按钮

## TypeScript

```tsx
import type { ConversationProps } from "@/components/agent/conversation";

const props: ConversationProps = {
  threadId: "thread-123",
  className: "h-full",
  emptyState: <div>没有消息</div>,
};
```

## 可访问性

对话包括：

- **键盘导航** - 箭头键和 Tab 支持
- **屏幕阅读器支持** - ARIA 标签和角色
- **焦点管理** - 正确的焦点指示器

## 性能

对话针对性能进行了优化：

- **虚拟滚动** - 高效渲染大型消息列表
- **消息记忆化** - 防止不必要的重新渲染
- **延迟加载** - 按需加载消息历史

## 下一步

<Cards>
  <Card title="Prompt Input" href="/docs/components/prompt-input" />
  <Card title="Provider" href="/docs/components/provider" />
  <Card title="Sidebar" href="/docs/components/sidebar" />
</Cards>
