{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "file-explorer",
  "type": "registry:component",
  "title": "AgentStart File Explorer",
  "description": "File explorer tree with search, filtering, and smooth expand/collapse animations backed by TanStack Query.",
  "dependencies": [
    "@base-ui-components/react",
    "@phosphor-icons/react",
    "@tanstack/react-query",
    "agentstart",
    "motion",
    "react"
  ],
  "registryDependencies": [
    "@coss/badge",
    "@coss/button",
    "@coss/empty",
    "@coss/input-group",
    "@coss/scroll-area",
    "@coss/skeleton"
  ],
  "files": [
    {
      "path": "src/registry/agentstart/file-explorer.tsx",
      "content": "/* agent-frontmatter:start\nAGENT: File explorer container component with animated tree view\nPURPOSE: Complete file tree explorer with search, filtering, and smooth animations\nUSAGE: import { FileExplorer, FileTreeProvider, useFileTree, FileNode } from \"@/components/agent/file-explorer\"\nEXPORTS: FileExplorer, FileTreeProvider, useFileTree, FileNode, FileTreeNode\nFEATURES:\n  - File tree display with React Context state management\n  - Animated expand/collapse with motion library\n  - Recursive tree node rendering with smooth transitions\n  - Search and filter functionality\n  - Tree connection lines\n  - ScrollArea integration\n  - Keyboard navigation\n  - File tree data storage and expansion tracking\n  - Phosphor icon integration\nSEARCHABLE: file explorer, file browser, directory tree, file navigation, file tree context, animated tree\nagent-frontmatter:end */\n\n\"use client\";\n\nimport { ContextMenu } from \"@base-ui-components/react/context-menu\";\nimport {\n  ArrowClockwiseIcon,\n  CaretRightIcon,\n  CopyIcon,\n  DownloadIcon,\n  EmptyIcon,\n  FileIcon,\n  FilePlusIcon,\n  FolderIcon,\n  FolderOpenIcon,\n  FolderPlusIcon,\n  MagnifyingGlassIcon,\n  PencilSimpleIcon,\n  TrashIcon,\n  WarningCircleIcon,\n  XIcon,\n} from \"@phosphor-icons/react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useAgentStartContext } from \"agentstart/client\";\nimport { AnimatePresence, motion } from \"motion/react\";\nimport {\n  createContext,\n  memo,\n  type ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Empty,\n  EmptyContent,\n  EmptyDescription,\n  EmptyHeader,\n  EmptyMedia,\n  EmptyTitle,\n} from \"@/components/ui/empty\";\nimport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupInput,\n  InputGroupText,\n} from \"@/components/ui/input-group\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { cn } from \"@/lib/utils\";\n\n// ============================================================================\n// Types & Interfaces\n// ============================================================================\n\nexport interface FileNode {\n  name: string;\n  path: string;\n  parentPath: string;\n  isFile: boolean;\n  isDirectory: boolean;\n  children?: Map<string, FileNode>;\n  /** Git change information for the file */\n  changes?: {\n    status: \"added\" | \"modified\" | \"deleted\" | \"renamed\" | \"untracked\";\n    additions: number;\n    deletions: number;\n  };\n}\n\ninterface FileTreeState {\n  // State\n  fileTree: Map<string, FileNode>;\n  expandedPaths: Set<string>;\n  selectedPath: string | null;\n\n  // Actions\n  setFileTree: (entries: FileNode[]) => void;\n  toggleExpanded: (path: string) => void;\n  setSelectedPath: (path: string | null) => void;\n  clearAll: () => void;\n}\n\nexport interface FileExplorerProps {\n  /** Initial file tree data (flat list of entries) - optional, if not provided, will fetch via API */\n  entries?: FileNode[];\n  /** Callback when a file is clicked */\n  onFileClick?: (node: FileNode) => void;\n  /** Optional class name for the container */\n  className?: string;\n  /** Whether to show search input */\n  showSearch?: boolean;\n  /** Placeholder text for search input */\n  searchPlaceholder?: string;\n  /** Query configuration - only used when entries is not provided */\n  query?: {\n    /** Path to list (default: \"/\") */\n    path?: string;\n    /** Whether to recursively list subdirectories (default: false) */\n    recursive?: boolean;\n    /** Glob patterns to ignore */\n    ignore?: string[];\n  };\n  /** Custom empty state */\n  emptyState?: ReactNode;\n  /** Custom error state */\n  errorState?: (error: Error, retry: () => void) => ReactNode;\n  /** Show tree connection lines */\n  showLines?: boolean;\n  /** Indentation per level in pixels */\n  indent?: number;\n  /** Enable expand/collapse animations */\n  animateExpand?: boolean;\n}\n\n// ============================================================================\n// Context & Provider\n// ============================================================================\n\nconst FileTreeContext = createContext<FileTreeState | undefined>(undefined);\n\nexport function FileTreeProvider({ children }: { children: ReactNode }) {\n  const [fileTree, setFileTreeState] = useState<Map<string, FileNode>>(\n    new Map(),\n  );\n  const [expandedPaths, setExpandedPaths] = useState<Set<string>>(new Set());\n  const [selectedPath, setSelectedPathState] = useState<string | null>(null);\n\n  const setFileTree = useCallback((entries: FileNode[]) => {\n    const newFileTree = new Map<string, FileNode>();\n\n    // First pass: create all nodes\n    for (const entry of entries) {\n      newFileTree.set(entry.path, {\n        ...entry,\n        children: entry.isDirectory ? new Map() : undefined,\n      });\n    }\n\n    // Second pass: build parent-child relationships\n    for (const entry of entries) {\n      if (entry.parentPath) {\n        const parent = newFileTree.get(entry.parentPath);\n        if (parent?.children) {\n          parent.children.set(entry.path, newFileTree.get(entry.path)!);\n        }\n      }\n    }\n\n    setFileTreeState(newFileTree);\n  }, []);\n\n  const toggleExpanded = useCallback((path: string) => {\n    setExpandedPaths((prev) => {\n      const newExpanded = new Set(prev);\n      if (newExpanded.has(path)) {\n        newExpanded.delete(path);\n      } else {\n        newExpanded.add(path);\n      }\n      return newExpanded;\n    });\n  }, []);\n\n  const setSelectedPath = useCallback((path: string | null) => {\n    setSelectedPathState(path);\n  }, []);\n\n  const clearAll = useCallback(() => {\n    setFileTreeState(new Map());\n    setExpandedPaths(new Set());\n    setSelectedPathState(null);\n  }, []);\n\n  const value = useMemo<FileTreeState>(\n    () => ({\n      fileTree,\n      expandedPaths,\n      selectedPath,\n      setFileTree,\n      toggleExpanded,\n      setSelectedPath,\n      clearAll,\n    }),\n    [\n      fileTree,\n      expandedPaths,\n      selectedPath,\n      setFileTree,\n      toggleExpanded,\n      setSelectedPath,\n      clearAll,\n    ],\n  );\n\n  return (\n    <FileTreeContext.Provider value={value}>\n      {children}\n    </FileTreeContext.Provider>\n  );\n}\n\nexport function useFileTree(): FileTreeState {\n  const context = useContext(FileTreeContext);\n  if (context === undefined) {\n    throw new Error(\"useFileTree must be used within a FileTreeProvider\");\n  }\n  return context;\n}\n\n// ============================================================================\n// File Explorer Components\n// ============================================================================\n\nfunction FileExplorerContent({\n  onFileClick,\n  onRename,\n  onDelete,\n  onCreateFile,\n  onCreateFolder,\n  onDownload,\n  onRefresh,\n  showSearch = true,\n  searchPlaceholder = \"Search files...\",\n  showLines = true,\n  indent = 20,\n  animateExpand = true,\n}: Omit<\n  FileExplorerProps,\n  \"entries\" | \"className\" | \"query\" | \"emptyState\" | \"errorState\"\n> & {\n  onRename?: (node: FileNode, newName: string) => void;\n  onDelete?: (node: FileNode) => void;\n  onCreateFile?: (node: FileNode) => void;\n  onCreateFolder?: (node: FileNode) => void;\n  onDownload?: (node: FileNode) => void;\n  onRefresh?: () => void;\n}) {\n  const { fileTree } = useFileTree();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  // Filter root nodes based on search query\n  const filteredRoots = useMemo(() => {\n    const roots = Array.from(fileTree.values()).filter(\n      (node) => !node.parentPath || node.parentPath === \"/\",\n    );\n\n    if (!searchQuery.trim()) {\n      return roots;\n    }\n\n    const query = searchQuery.toLowerCase();\n    return roots.filter((node) => node.name.toLowerCase().includes(query));\n  }, [fileTree, searchQuery]);\n\n  const handleClearSearch = useCallback(() => {\n    setSearchQuery(\"\");\n  }, []);\n\n  // Create a root node for context menu on empty space\n  const rootNode: FileNode = {\n    name: \"/\",\n    path: \"/\",\n    parentPath: \"\",\n    isFile: false,\n    isDirectory: true,\n  };\n\n  return (\n    <div className=\"flex h-full flex-col\">\n      {/* Search input */}\n      {showSearch && (\n        <div className=\"border-b p-2\">\n          <InputGroup>\n            <InputGroupAddon align=\"inline-start\">\n              <InputGroupText>\n                <MagnifyingGlassIcon weight=\"duotone\" />\n              </InputGroupText>\n            </InputGroupAddon>\n            <InputGroupInput\n              type=\"text\"\n              placeholder={searchPlaceholder}\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n            />\n            {searchQuery && (\n              <InputGroupAddon align=\"inline-end\">\n                <Button\n                  type=\"button\"\n                  onClick={handleClearSearch}\n                  variant=\"ghost\"\n                  size=\"icon-sm\"\n                  className=\"size-6\"\n                >\n                  <XIcon className=\"size-3\" />\n                </Button>\n              </InputGroupAddon>\n            )}\n          </InputGroup>\n        </div>\n      )}\n\n      {/* File tree */}\n      <ScrollArea style={{ flex: 1 }}>\n        <ContextMenu.Root>\n          <ContextMenu.Trigger className=\"min-h-full\">\n            <motion.div\n              className=\"min-h-full p-2\"\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ duration: 0.15, ease: \"easeOut\" }}\n            >\n              {filteredRoots.length === 0 ? (\n                <div className=\"py-8 text-center text-muted-foreground text-sm\">\n                  {searchQuery ? \"No files found\" : \"No files to display\"}\n                </div>\n              ) : (\n                filteredRoots.map((node, index) => (\n                  <FileTreeNode\n                    key={node.path}\n                    node={node}\n                    onFileClick={onFileClick}\n                    onRename={onRename}\n                    onDelete={onDelete}\n                    onCreateFile={onCreateFile}\n                    onCreateFolder={onCreateFolder}\n                    onDownload={onDownload}\n                    onRefresh={onRefresh}\n                    isLast={index === filteredRoots.length - 1}\n                    showLines={showLines}\n                    indent={indent}\n                    animateExpand={animateExpand}\n                  />\n                ))\n              )}\n            </motion.div>\n          </ContextMenu.Trigger>\n\n          <ContextMenu.Portal>\n            <ContextMenu.Positioner className=\"z-50\" sideOffset={4}>\n              <ContextMenu.Popup\n                className={cn(\n                  \"min-w-48 rounded-lg border bg-popover p-1 shadow-lg\",\n                  \"data-[state=closed]:animate-out data-[state=open]:animate-in\",\n                  \"data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n                  \"data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95\",\n                )}\n              >\n                {/* New File */}\n                {onCreateFile && (\n                  <ContextMenu.Item\n                    className={cn(\n                      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1 text-sm outline-none\",\n                      \"data-highlighted:bg-accent data-highlighted:text-accent-foreground\",\n                    )}\n                    onClick={() => onCreateFile(rootNode)}\n                  >\n                    <FilePlusIcon className=\"size-4\" weight=\"duotone\" />\n                    <span>New File</span>\n                  </ContextMenu.Item>\n                )}\n\n                {/* New Folder */}\n                {onCreateFolder && (\n                  <ContextMenu.Item\n                    className={cn(\n                      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1 text-sm outline-none\",\n                      \"data-highlighted:bg-accent data-highlighted:text-accent-foreground\",\n                    )}\n                    onClick={() => onCreateFolder(rootNode)}\n                  >\n                    <FolderPlusIcon className=\"size-4\" weight=\"duotone\" />\n                    <span>New Folder</span>\n                  </ContextMenu.Item>\n                )}\n\n                {/* Separator */}\n                {(onCreateFile || onCreateFolder) && onRefresh && (\n                  <ContextMenu.Separator className=\"my-1 h-px bg-border\" />\n                )}\n\n                {/* Refresh */}\n                {onRefresh && (\n                  <ContextMenu.Item\n                    className={cn(\n                      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1 text-sm outline-none\",\n                      \"data-highlighted:bg-accent data-highlighted:text-accent-foreground\",\n                    )}\n                    onClick={onRefresh}\n                  >\n                    <ArrowClockwiseIcon className=\"size-4\" weight=\"duotone\" />\n                    <span>Refresh</span>\n                  </ContextMenu.Item>\n                )}\n              </ContextMenu.Popup>\n            </ContextMenu.Positioner>\n          </ContextMenu.Portal>\n        </ContextMenu.Root>\n      </ScrollArea>\n    </div>\n  );\n}\n\nexport function FileExplorer({\n  entries,\n  onFileClick,\n  className,\n  query,\n  emptyState,\n  errorState,\n  showSearch = true,\n  searchPlaceholder = \"Search files...\",\n  showLines = true,\n  indent = 20,\n  animateExpand = true,\n}: FileExplorerProps) {\n  const { orpc, threadId } = useAgentStartContext();\n\n  // If entries provided directly, use them; otherwise fetch via API\n  const {\n    data: fetchedEntries,\n    error,\n    isLoading,\n    isError,\n    refetch,\n  } = useQuery({\n    ...orpc.sandbox.list.queryOptions({\n      input: {\n        path: query?.path || \"/\",\n        recursive: query?.recursive || false,\n        ignore: query?.ignore,\n        threadId,\n      },\n    }),\n    enabled: !entries, // Only fetch if entries not provided\n  });\n\n  // Use provided entries or fetched entries\n  const effectiveEntries = entries || fetchedEntries || [];\n\n  // Rename mutation\n  const renameMutation = useMutation(\n    orpc.sandbox.rename.mutationOptions({\n      onSuccess: () => {\n        refetch();\n      },\n    }),\n  );\n\n  // Delete mutation\n  const deleteMutation = useMutation(\n    orpc.sandbox.delete.mutationOptions({\n      onSuccess: () => {\n        refetch();\n      },\n    }),\n  );\n\n  // Create file mutation\n  const createFileMutation = useMutation(\n    orpc.sandbox.createFile.mutationOptions({\n      onSuccess: () => {\n        refetch();\n      },\n    }),\n  );\n\n  // Create folder mutation\n  const createFolderMutation = useMutation(\n    orpc.sandbox.createFolder.mutationOptions({\n      onSuccess: () => {\n        refetch();\n      },\n    }),\n  );\n\n  // Download mutation\n  const downloadMutation = useMutation(\n    orpc.sandbox.download.mutationOptions({\n      onSuccess: (data) => {\n        // Create a blob and trigger download\n        const blob = new Blob([data.content], { type: \"text/plain\" });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement(\"a\");\n        a.href = url;\n        a.download = data.filename;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n      },\n    }),\n  );\n\n  const handleRename = (node: FileNode, newName: string) => {\n    renameMutation.mutate({ path: node.path, newName });\n  };\n\n  const handleDelete = (node: FileNode) => {\n    deleteMutation.mutate({ path: node.path });\n  };\n\n  const handleCreateFile = (parentNode: FileNode) => {\n    const fileName = window.prompt(\"Enter file name:\");\n    if (fileName) {\n      const newPath = `${parentNode.path}/${fileName}`;\n      createFileMutation.mutate({ path: newPath, content: \"\" });\n    }\n  };\n\n  const handleCreateFolder = (parentNode: FileNode) => {\n    const folderName = window.prompt(\"Enter folder name:\");\n    if (folderName) {\n      const newPath = `${parentNode.path}/${folderName}`;\n      createFolderMutation.mutate({ path: newPath });\n    }\n  };\n\n  const handleDownload = (node: FileNode) => {\n    downloadMutation.mutate({ path: node.path });\n  };\n\n  const handleRefresh = () => {\n    refetch();\n  };\n\n  // Default empty state\n  const defaultEmptyState = (\n    <Empty>\n      <EmptyMedia>\n        <EmptyIcon className=\"size-12\" weight=\"duotone\" />\n      </EmptyMedia>\n      <EmptyHeader>\n        <EmptyTitle>No files found</EmptyTitle>\n        <EmptyDescription>\n          The directory is empty or no files match your search.\n        </EmptyDescription>\n      </EmptyHeader>\n    </Empty>\n  );\n\n  // Default error state\n  const defaultErrorState = (err: Error, retry: () => void) => (\n    <Empty>\n      <EmptyMedia>\n        <WarningCircleIcon\n          className=\"size-12 text-destructive\"\n          weight=\"duotone\"\n        />\n      </EmptyMedia>\n      <EmptyHeader>\n        <EmptyTitle>Failed to load files</EmptyTitle>\n        <EmptyDescription>{err.message}</EmptyDescription>\n      </EmptyHeader>\n      <EmptyContent>\n        <Button onClick={retry} variant=\"outline\">\n          Try again\n        </Button>\n      </EmptyContent>\n    </Empty>\n  );\n\n  return (\n    <div className={cn(\"h-full w-full overflow-hidden\", className)}>\n      <FileTreeProvider>\n        {isLoading && !entries ? (\n          <div className=\"p-4\">\n            <Skeleton />\n            <Skeleton />\n            <Skeleton />\n          </div>\n        ) : isError && !entries ? (\n          <div className=\"flex h-full items-center justify-center p-4\">\n            {errorState\n              ? errorState(error as Error, refetch)\n              : defaultErrorState(error as Error, refetch)}\n          </div>\n        ) : effectiveEntries.length === 0 ? (\n          <div className=\"flex h-full items-center justify-center p-4\">\n            {emptyState || defaultEmptyState}\n          </div>\n        ) : (\n          <>\n            <FileExplorerInitializer entries={effectiveEntries} />\n            <FileExplorerContent\n              onFileClick={onFileClick}\n              onRename={handleRename}\n              onDelete={handleDelete}\n              onCreateFile={handleCreateFile}\n              onCreateFolder={handleCreateFolder}\n              onDownload={handleDownload}\n              onRefresh={handleRefresh}\n              showSearch={showSearch}\n              searchPlaceholder={searchPlaceholder}\n              showLines={showLines}\n              indent={indent}\n              animateExpand={animateExpand}\n            />\n          </>\n        )}\n      </FileTreeProvider>\n    </div>\n  );\n}\n\n/** Helper component to initialize file tree data */\nfunction FileExplorerInitializer({ entries }: { entries: FileNode[] }) {\n  const { setFileTree } = useFileTree();\n\n  // Initialize file tree when entries change\n  useEffect(() => {\n    if (entries.length > 0) {\n      setFileTree(entries);\n    }\n  }, [entries, setFileTree]);\n\n  return null;\n}\n\n// ============================================================================\n// File Badge Component\n// ============================================================================\n\ninterface FileBadgeProps {\n  status: \"added\" | \"modified\" | \"deleted\" | \"renamed\" | \"untracked\";\n  additions: number;\n  deletions: number;\n}\n\nfunction FileBadge({ status, additions, deletions }: FileBadgeProps) {\n  // Only show if there are actual changes\n  if (additions === 0 && deletions === 0 && status === \"untracked\") {\n    return null;\n  }\n\n  return (\n    <div className=\"flex shrink-0 items-center gap-1\">\n      {/* Show additions */}\n      {additions > 0 && (\n        <Badge\n          variant=\"success\"\n          size=\"sm\"\n          className=\"bg-green-500/10 font-mono\"\n        >\n          +{additions}\n        </Badge>\n      )}\n\n      {/* Show deletions */}\n      {deletions > 0 && (\n        <Badge variant=\"error\" size=\"sm\" className=\"font-mono\">\n          -{deletions}\n        </Badge>\n      )}\n    </div>\n  );\n}\n\n// ============================================================================\n// File Tree Node Component\n// ============================================================================\n\nexport interface FileTreeNodeProps {\n  node: FileNode;\n  level?: number;\n  onFileClick?: (node: FileNode) => void;\n  onRename?: (node: FileNode, newName: string) => void | Promise<void>;\n  onDelete?: (node: FileNode) => void | Promise<void>;\n  onCreateFile?: (node: FileNode) => void | Promise<void>;\n  onCreateFolder?: (node: FileNode) => void | Promise<void>;\n  onDownload?: (node: FileNode) => void | Promise<void>;\n  onRefresh?: () => void | Promise<void>;\n  isLast?: boolean;\n  parentPath?: boolean[];\n  showLines?: boolean;\n  indent?: number;\n  animateExpand?: boolean;\n}\n\nexport const FileTreeNode = memo(function FileTreeNode({\n  node,\n  level = 0,\n  onFileClick,\n  onRename,\n  onDelete,\n  onCreateFile,\n  onCreateFolder,\n  onDownload,\n  onRefresh,\n  isLast = false,\n  parentPath = [],\n  showLines = true,\n  indent = 20,\n  animateExpand = true,\n}: FileTreeNodeProps) {\n  const { expandedPaths, selectedPath, toggleExpanded, setSelectedPath } =\n    useFileTree();\n\n  const isExpanded = expandedPaths.has(node.path);\n  const isSelected = selectedPath === node.path;\n  const hasChildren = node.children && node.children.size > 0;\n  const currentPath = [...parentPath, isLast];\n\n  const handleClick = () => {\n    if (node.isDirectory) {\n      toggleExpanded(node.path);\n    } else {\n      setSelectedPath(node.path);\n      onFileClick?.(node);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" || e.key === \" \") {\n      e.preventDefault();\n      handleClick();\n    }\n  };\n\n  const handleCopyPath = async () => {\n    try {\n      await navigator.clipboard.writeText(node.path);\n    } catch (err) {\n      console.error(\"Failed to copy path:\", err);\n    }\n  };\n\n  const handleRename = () => {\n    const newName = window.prompt(\"Enter new name:\", node.name);\n    if (newName && newName !== node.name) {\n      onRename?.(node, newName);\n    }\n  };\n\n  const handleDelete = () => {\n    const confirmMessage = node.isDirectory\n      ? `Are you sure you want to delete the folder \"${node.name}\" and all its contents?`\n      : `Are you sure you want to delete \"${node.name}\"?`;\n\n    if (window.confirm(confirmMessage)) {\n      onDelete?.(node);\n    }\n  };\n\n  return (\n    <div>\n      <ContextMenu.Root>\n        <ContextMenu.Trigger>\n          <motion.div\n            role=\"button\"\n            tabIndex={0}\n            className={cn(\n              \"relative flex cursor-pointer items-center gap-1.5 rounded-md px-2 py-1 text-sm transition-all duration-200 hover:bg-accent/50\",\n              isSelected && \"bg-accent/80\",\n            )}\n            style={{ paddingLeft: `${level * indent + 8}px` }}\n            onClick={handleClick}\n            onKeyDown={handleKeyDown}\n            whileTap={{ scale: 0.98, transition: { duration: 0.06 } }}\n          >\n            {/* Tree Lines */}\n            {showLines && level > 0 && (\n              <div className=\"pointer-events-none absolute top-0 bottom-0 left-0\">\n                {currentPath.map((isLastInPath, pathIndex) => (\n                  <div\n                    key={pathIndex}\n                    className=\"absolute top-0 bottom-0 border-border/40 border-l\"\n                    style={{\n                      left: pathIndex * indent + 12,\n                      display:\n                        pathIndex === currentPath.length - 1 && isLastInPath\n                          ? \"none\"\n                          : \"block\",\n                    }}\n                  />\n                ))}\n                <div\n                  className=\"absolute top-1/2 border-border/40 border-t\"\n                  style={{\n                    left: (level - 1) * indent + 12,\n                    width: indent - 4,\n                    transform: \"translateY(-1px)\",\n                  }}\n                />\n                {isLast && (\n                  <div\n                    className=\"absolute top-0 border-border/40 border-l\"\n                    style={{\n                      left: (level - 1) * indent + 12,\n                      height: \"50%\",\n                    }}\n                  />\n                )}\n              </div>\n            )}\n\n            {/* Expand/collapse icon for directories */}\n            <motion.div\n              className=\"flex size-4 items-center justify-center\"\n              animate={{ rotate: node.isDirectory && isExpanded ? 90 : 0 }}\n              transition={{ duration: 0.1, ease: \"easeInOut\" }}\n            >\n              {node.isDirectory ? (\n                <CaretRightIcon className=\"size-3 text-muted-foreground\" />\n              ) : (\n                <span className=\"w-4\" />\n              )}\n            </motion.div>\n\n            {/* File/folder icon with status indicator */}\n            <div className=\"relative\">\n              <motion.div\n                className=\"flex size-4 items-center justify-center text-muted-foreground\"\n                whileHover={{ scale: 1.1 }}\n                transition={{ duration: 0.1 }}\n              >\n                {node.isDirectory ? (\n                  isExpanded ? (\n                    <FolderOpenIcon className=\"size-4\" weight=\"duotone\" />\n                  ) : (\n                    <FolderIcon className=\"size-4\" weight=\"duotone\" />\n                  )\n                ) : (\n                  <FileIcon className=\"size-4\" weight=\"duotone\" />\n                )}\n              </motion.div>\n\n              {/* Status indicator dot */}\n              {node.changes && (\n                <div\n                  className={cn(\n                    \"-top-0.5 -right-0.5 absolute size-2 rounded-full border border-background\",\n                    node.changes.status === \"added\" && \"bg-green-500\",\n                    node.changes.status === \"modified\" && \"bg-orange-500\",\n                    node.changes.status === \"deleted\" && \"bg-red-500\",\n                    node.changes.status === \"renamed\" && \"bg-blue-500\",\n                    node.changes.status === \"untracked\" && \"bg-gray-500\",\n                  )}\n                />\n              )}\n            </div>\n\n            {/* File/folder name */}\n            <span\n              className={cn(\n                \"flex-1 truncate transition-colors\",\n                isSelected ? \"text-foreground\" : \"text-muted-foreground\",\n              )}\n            >\n              {node.name}\n            </span>\n\n            {/* Git change statistics */}\n            {node.changes && (\n              <FileBadge\n                status={node.changes.status}\n                additions={node.changes.additions}\n                deletions={node.changes.deletions}\n              />\n            )}\n          </motion.div>\n        </ContextMenu.Trigger>\n\n        <ContextMenu.Portal>\n          <ContextMenu.Positioner className=\"z-50\" sideOffset={4}>\n            <ContextMenu.Popup\n              className={cn(\n                \"min-w-48 rounded-lg border bg-popover p-1 shadow-lg\",\n                \"data-[state=closed]:animate-out data-[state=open]:animate-in\",\n                \"data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n                \"data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95\",\n              )}\n            >\n              {/* New File / New Folder for directories */}\n              {node.isDirectory && onCreateFile && (\n                <ContextMenu.Item\n                  className={cn(\n                    \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1 text-sm outline-none\",\n                    \"data-highlighted:bg-accent data-highlighted:text-accent-foreground\",\n                  )}\n                  onClick={() => onCreateFile(node)}\n                >\n                  <FilePlusIcon className=\"size-4\" weight=\"duotone\" />\n                  <span>New File</span>\n                </ContextMenu.Item>\n              )}\n\n              {node.isDirectory && onCreateFolder && (\n                <ContextMenu.Item\n                  className={cn(\n                    \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1 text-sm outline-none\",\n                    \"data-highlighted:bg-accent data-highlighted:text-accent-foreground\",\n                  )}\n                  onClick={() => onCreateFolder(node)}\n                >\n                  <FolderPlusIcon className=\"size-4\" weight=\"duotone\" />\n                  <span>New Folder</span>\n                </ContextMenu.Item>\n              )}\n\n              {/* Download for files */}\n              {node.isFile && onDownload && (\n                <ContextMenu.Item\n                  className={cn(\n                    \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1 text-sm outline-none\",\n                    \"data-highlighted:bg-accent data-highlighted:text-accent-foreground\",\n                  )}\n                  onClick={() => onDownload(node)}\n                >\n                  <DownloadIcon className=\"size-4\" weight=\"duotone\" />\n                  <span>Download</span>\n                </ContextMenu.Item>\n              )}\n\n              {/* Separator after directory/file specific actions */}\n              {((node.isDirectory && (onCreateFile || onCreateFolder)) ||\n                (node.isFile && onDownload)) && (\n                <ContextMenu.Separator className=\"my-1 h-px bg-border\" />\n              )}\n\n              {/* Rename */}\n              {onRename && (\n                <ContextMenu.Item\n                  className={cn(\n                    \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1 text-sm outline-none\",\n                    \"data-highlighted:bg-accent data-highlighted:text-accent-foreground\",\n                  )}\n                  onClick={handleRename}\n                >\n                  <PencilSimpleIcon className=\"size-4\" weight=\"duotone\" />\n                  <span>Rename</span>\n                </ContextMenu.Item>\n              )}\n\n              {/* Delete */}\n              {onDelete && (\n                <ContextMenu.Item\n                  className={cn(\n                    \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1 text-sm outline-none\",\n                    \"data-highlighted:bg-accent data-highlighted:text-accent-foreground\",\n                  )}\n                  onClick={handleDelete}\n                >\n                  <TrashIcon className=\"size-4\" weight=\"duotone\" />\n                  <span>Delete</span>\n                </ContextMenu.Item>\n              )}\n\n              {/* Separator before utility actions */}\n              {(onRename || onDelete) && (\n                <ContextMenu.Separator className=\"my-1 h-px bg-border\" />\n              )}\n\n              {/* Copy Path */}\n              <ContextMenu.Item\n                className={cn(\n                  \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1 text-sm outline-none\",\n                  \"data-highlighted:bg-accent data-highlighted:text-accent-foreground\",\n                )}\n                onClick={handleCopyPath}\n              >\n                <CopyIcon className=\"size-4\" weight=\"duotone\" />\n                <span>Copy Path</span>\n              </ContextMenu.Item>\n\n              {/* Refresh */}\n              {onRefresh && (\n                <ContextMenu.Item\n                  className={cn(\n                    \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1 text-sm outline-none\",\n                    \"data-highlighted:bg-accent data-highlighted:text-accent-foreground\",\n                  )}\n                  onClick={onRefresh}\n                >\n                  <ArrowClockwiseIcon className=\"size-4\" weight=\"duotone\" />\n                  <span>Refresh</span>\n                </ContextMenu.Item>\n              )}\n            </ContextMenu.Popup>\n          </ContextMenu.Positioner>\n        </ContextMenu.Portal>\n      </ContextMenu.Root>\n\n      {/* Render children if directory is expanded */}\n      <AnimatePresence>\n        {node.isDirectory && isExpanded && hasChildren && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{\n              duration: animateExpand ? 0.15 : 0,\n              ease: \"easeInOut\",\n            }}\n            className=\"overflow-hidden\"\n          >\n            <motion.div\n              initial={{ y: -10 }}\n              animate={{ y: 0 }}\n              exit={{ y: -10 }}\n              transition={{\n                duration: animateExpand ? 0.1 : 0,\n                delay: animateExpand ? 0.05 : 0,\n              }}\n            >\n              {Array.from(node.children!.values()).map((child, index) => (\n                <FileTreeNode\n                  key={child.path}\n                  node={child}\n                  level={level + 1}\n                  onFileClick={onFileClick}\n                  onRename={onRename}\n                  onDelete={onDelete}\n                  onCreateFile={onCreateFile}\n                  onCreateFolder={onCreateFolder}\n                  onDownload={onDownload}\n                  onRefresh={onRefresh}\n                  isLast={index === node.children!.size - 1}\n                  parentPath={currentPath}\n                  showLines={showLines}\n                  indent={indent}\n                  animateExpand={animateExpand}\n                />\n              ))}\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n});\n",
      "type": "registry:component",
      "target": "components/agent/file-explorer.tsx"
    }
  ]
}