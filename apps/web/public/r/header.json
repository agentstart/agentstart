{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "header",
  "type": "registry:component",
  "title": "AgentStart Header",
  "description": "Thread header component that fetches thread metadata via oRPC and TanStack Query with rename/delete actions and timestamp display.",
  "dependencies": [
    "@phosphor-icons/react",
    "@tanstack/react-query",
    "agentstart",
    "react"
  ],
  "registryDependencies": [
    "@coss/button",
    "@coss/menu",
    "@coss/skeleton",
    "@coss/tooltip"
  ],
  "files": [
    {
      "path": "src/registry/agentstart/header.tsx",
      "content": "/* agent-frontmatter:start\nAGENT: Thread header component\nPURPOSE: Display thread title and metadata using oRPC\nUSAGE: <Header threadId={threadId} />\nEXPORTS: Header, HeaderProps, HeaderSkeleton\nFEATURES:\n  - Fetches thread data using TanStack Query and oRPC\n  - Displays thread title, visibility, and timestamps\n  - Provides loading skeleton state\n  - Error handling with retry functionality\nSEARCHABLE: thread header, thread title, thread info, orpc header\nagent-frontmatter:end */\n\n\"use client\";\n\nimport {\n  GearIcon,\n  PencilSimpleIcon,\n  PencilSimpleLineIcon,\n  TrashIcon,\n  WarningCircleIcon,\n} from \"@phosphor-icons/react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { useAgentStartContext } from \"agentstart/client\";\nimport type { ComponentProps, ReactNode } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Menu,\n  MenuGroup,\n  MenuGroupLabel,\n  MenuItem,\n  MenuPopup,\n  MenuTrigger,\n} from \"@/components/ui/menu\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\nimport { RelativeTime } from \"./relative-time\";\n\nexport type HeaderProps = ComponentProps<\"header\"> & {\n  /**\n   * Custom loading state element while fetching thread data\n   */\n  loadingState?: ReactNode;\n  /**\n   * Custom error renderer when fetching thread fails\n   */\n  errorState?: (error: Error, retry: () => void) => ReactNode;\n  /**\n   * Hide specific metadata fields\n   */\n  hideMetadata?: {\n    visibility?: boolean;\n    timestamps?: boolean;\n    userId?: boolean;\n  };\n  /**\n   * Custom element to render before the header content\n   */\n  leading?: ReactNode;\n  /**\n   * Custom element to render after the header content\n   */\n  trailing?: ReactNode;\n  /**\n   * Callback when thread is renamed\n   */\n  onRename?: (threadId: string, newTitle: string) => void;\n  /**\n   * Callback when thread is deleted\n   */\n  onDelete?: (threadId: string) => void;\n  /**\n   * Hide the settings button\n   */\n  hideSettings?: boolean;\n};\n\nexport function Header({\n  className,\n  loadingState,\n  errorState,\n  hideMetadata = {},\n  leading,\n  trailing,\n  onRename,\n  onDelete,\n  hideSettings = false,\n  ...props\n}: HeaderProps) {\n  const { orpc, threadId } = useAgentStartContext();\n\n  const { data, error, isLoading, isError, refetch } = useQuery(\n    orpc.thread.get.queryOptions({\n      input: { threadId: threadId! },\n      enabled: !!threadId,\n    }),\n  );\n  const queryClient = useQueryClient();\n\n  // Rename mutation\n  const updateMutation = useMutation(\n    orpc.thread.update.mutationOptions({\n      onSuccess: () => {\n        refetch();\n        queryClient.invalidateQueries(orpc.thread.list.queryOptions());\n      },\n    }),\n  );\n\n  // Delete mutation\n  const deleteMutation = useMutation(\n    orpc.thread.delete.mutationOptions({\n      onSuccess: () => {\n        onDelete?.(threadId!);\n      },\n    }),\n  );\n\n  if (isLoading) {\n    return loadingState ?? <HeaderSkeleton className={className} />;\n  }\n\n  if (isError && error) {\n    const defaultErrorState = (\n      <header\n        className={cn(\n          \"flex items-center justify-between gap-1 border-b bg-background px-6 py-3\",\n          className,\n        )}\n        {...props}\n      >\n        <div className=\"flex items-center gap-2 text-destructive\">\n          <WarningCircleIcon className=\"size-5\" weight=\"duotone\" />\n          <span className=\"font-medium text-sm\">Failed to load thread</span>\n        </div>\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => refetch()}\n        >\n          Retry\n        </Button>\n      </header>\n    );\n\n    return errorState?.(error, () => refetch()) ?? defaultErrorState;\n  }\n\n  if (!data?.thread) {\n    return null;\n  }\n\n  const { thread } = data;\n\n  const handleRename = () => {\n    const newTitle = window.prompt(\n      \"Enter new thread title:\",\n      thread.title ?? \"\",\n    );\n    if (newTitle?.trim() && newTitle !== thread.title) {\n      updateMutation.mutate({\n        threadId: threadId!,\n        data: { title: newTitle.trim() },\n      });\n      onRename?.(threadId!, newTitle.trim());\n    }\n  };\n\n  const handleDelete = () => {\n    if (\n      window.confirm(\n        `Are you sure you want to delete \"${thread.title ?? \"this thread\"}\"?`,\n      )\n    ) {\n      deleteMutation.mutate({ threadId: threadId! });\n    }\n  };\n\n  return (\n    <header\n      className={cn(\n        \"flex items-center justify-between gap-1 border-b bg-background px-6 py-3\",\n        className,\n      )}\n      {...props}\n    >\n      {leading}\n\n      <div className=\"flex min-w-0 flex-1 items-center gap-2\">\n        <Tooltip>\n          <TooltipTrigger\n            render={\n              <h1\n                className=\"group max-w-1/2 cursor-pointer truncate font-semibold text-base hover:underline\"\n                onClick={handleRename}\n              >\n                {thread.title}\n                <PencilSimpleLineIcon\n                  weight=\"duotone\"\n                  className=\"-mt-0.5 ml-1 inline size-4! opacity-0 group-hover:opacity-100\"\n                />\n              </h1>\n            }\n          />\n          <TooltipContent>\n            <p>Rename</p>\n          </TooltipContent>\n        </Tooltip>\n      </div>\n\n      {!hideMetadata.timestamps && (thread.updatedAt || thread.createdAt) && (\n        <div className=\"flex items-center gap-2 text-muted-foreground text-xs\">\n          <span className=\"flex items-center gap-1\">\n            <RelativeTime\n              leading={<span>{thread.updatedAt ? \"Updated\" : \"Created\"}</span>}\n              timestamp={thread.updatedAt || thread.createdAt}\n            />\n          </span>\n        </div>\n      )}\n\n      {!hideSettings && (\n        <Menu>\n          <Tooltip>\n            <MenuTrigger\n              render={\n                <TooltipTrigger\n                  render={\n                    <Button variant=\"ghost\" size=\"icon-sm\">\n                      <GearIcon weight=\"duotone\" className=\"size-4\" />\n                    </Button>\n                  }\n                />\n              }\n            />\n            <TooltipContent>\n              <span>Settings</span>\n            </TooltipContent>\n          </Tooltip>\n\n          <MenuPopup>\n            <MenuGroup>\n              <MenuGroupLabel>Thread Settings</MenuGroupLabel>\n\n              <MenuItem onClick={handleRename}>\n                <PencilSimpleIcon weight=\"duotone\" className=\"size-4.5\" />{\" \"}\n                <span>Rename</span>\n              </MenuItem>\n              <MenuItem onClick={handleDelete}>\n                <TrashIcon\n                  weight=\"duotone\"\n                  className=\"size-4.5 text-destructive\"\n                  color=\"currentColor\"\n                />{\" \"}\n                <span className=\"text-destructive\">Delete</span>\n              </MenuItem>\n            </MenuGroup>\n          </MenuPopup>\n        </Menu>\n      )}\n\n      {trailing}\n    </header>\n  );\n}\n\nexport type HeaderSkeletonProps = ComponentProps<\"header\">;\n\nexport function HeaderSkeleton({ className, ...props }: HeaderSkeletonProps) {\n  return (\n    <header\n      className={cn(\n        \"flex items-center justify-between gap-1 border-b bg-background px-6 py-3\",\n        className,\n      )}\n      {...props}\n    >\n      <div className=\"flex items-center gap-3\">\n        <Skeleton className=\"h-6 w-48\" />\n        <Skeleton className=\"h-5 w-16\" />\n      </div>\n      <div className=\"flex items-center gap-2\">\n        <Skeleton className=\"h-4 w-32\" />\n      </div>\n    </header>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/agent/header.tsx"
    },
    {
      "path": "src/registry/agentstart/relative-time.tsx",
      "content": "/* agent-frontmatter:start\nAGENT: Relative time display component\nPURPOSE: Display human-readable relative timestamps with detailed tooltip\nUSAGE: <RelativeTime timestamp={timestamp} />\nEXPORTS: RelativeTime, RelativeTimeProps\nFEATURES:\n  - Displays simple relative time in trigger (e.g., \"2 days ago\")\n  - Shows detailed relative time in tooltip (e.g., \"2 days, 12 hours ago\")\n  - Shows UTC and local timezone in tooltip on hover\n  - Auto-updates every minute\n  - Handles Date objects and Unix timestamps\nSEARCHABLE: relative time, timestamp, time display, date formatting, timezone\nagent-frontmatter:end */\n\n\"use client\";\n\nimport { format, intervalToDuration } from \"date-fns\";\nimport type { ComponentProps, ReactNode } from \"react\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tooltip, TooltipPopup, TooltipTrigger } from \"@/components/ui/tooltip\";\n\nexport type RelativeTimeProps = {\n  /**\n   * Custom element to render before the time\n   */\n  leading?: ReactNode;\n  timestamp?: number | Date;\n} & Omit<ComponentProps<typeof TooltipTrigger>, \"children\">;\n\n/**\n * Calculate simple relative time (only the most significant unit)\n */\nfunction formatSimpleRelativeTime(date: Date): string {\n  const now = new Date();\n  const duration = intervalToDuration({ start: date, end: now });\n\n  // Return only the most significant time unit\n  if (duration.years && duration.years > 0) {\n    return `${duration.years} year${duration.years > 1 ? \"s\" : \"\"} ago`;\n  }\n  if (duration.months && duration.months > 0) {\n    return `${duration.months} month${duration.months > 1 ? \"s\" : \"\"} ago`;\n  }\n  if (duration.days && duration.days > 0) {\n    return `${duration.days} day${duration.days > 1 ? \"s\" : \"\"} ago`;\n  }\n  if (duration.hours && duration.hours > 0) {\n    return `${duration.hours} hour${duration.hours > 1 ? \"s\" : \"\"} ago`;\n  }\n  if (duration.minutes && duration.minutes > 0) {\n    return `${duration.minutes} minute${duration.minutes > 1 ? \"s\" : \"\"} ago`;\n  }\n  if (duration.seconds && duration.seconds > 0) {\n    return `${duration.seconds} second${duration.seconds > 1 ? \"s\" : \"\"} ago`;\n  }\n\n  return \"just now\";\n}\n\n/**\n * Calculate detailed relative time using date-fns intervalToDuration\n */\nfunction formatDetailedRelativeTime(date: Date): string {\n  const now = new Date();\n  const duration = intervalToDuration({ start: date, end: now });\n\n  const parts: string[] = [];\n\n  // Add up to 3 most significant time units\n  if (duration.years && duration.years > 0) {\n    parts.push(`${duration.years} year${duration.years > 1 ? \"s\" : \"\"}`);\n  }\n  if (duration.months && duration.months > 0 && parts.length < 3) {\n    parts.push(`${duration.months} month${duration.months > 1 ? \"s\" : \"\"}`);\n  }\n  if (duration.days && duration.days > 0 && parts.length < 3) {\n    parts.push(`${duration.days} day${duration.days > 1 ? \"s\" : \"\"}`);\n  }\n  if (duration.hours && duration.hours > 0 && parts.length < 3) {\n    parts.push(`${duration.hours} hour${duration.hours > 1 ? \"s\" : \"\"}`);\n  }\n  if (duration.minutes && duration.minutes > 0 && parts.length < 3) {\n    parts.push(`${duration.minutes} minute${duration.minutes > 1 ? \"s\" : \"\"}`);\n  }\n  if (duration.seconds && duration.seconds > 0 && parts.length < 3) {\n    parts.push(`${duration.seconds} second${duration.seconds > 1 ? \"s\" : \"\"}`);\n  }\n\n  return parts.length > 0 ? `${parts.join(\", \")} ago` : \"just now\";\n}\n\n/**\n * Get timezone offset string (e.g., \"GMT+8\", \"UTC\")\n */\nfunction getTimezoneString(): string {\n  const offset = -new Date().getTimezoneOffset();\n  if (offset === 0) return \"UTC\";\n\n  const hours = Math.floor(Math.abs(offset) / 60);\n  const minutes = Math.abs(offset) % 60;\n  const sign = offset >= 0 ? \"+\" : \"-\";\n\n  return `GMT${sign}${hours}${minutes > 0 ? `:${minutes.toString().padStart(2, \"0\")}` : \"\"}`;\n}\n\nexport const RelativeTime = ({\n  leading,\n  timestamp,\n  className,\n  ...props\n}: RelativeTimeProps) => {\n  const [simpleRelativeTime, setSimpleRelativeTime] = useState<string>(\"\");\n  const [detailedRelativeTime, setDetailedRelativeTime] = useState<string>(\"\");\n\n  // Format detailed time info for tooltip\n  const timeInfo = useMemo(() => {\n    if (!timestamp) return null;\n\n    const date = new Date(timestamp);\n    const utcDate = format(date, \"MMMM d, yyyy\");\n    const utcTime = format(date, \"hh:mm:ss a\");\n    const localDate = format(date, \"MMMM d, yyyy\");\n    const localTime = format(date, \"hh:mm:ss a\");\n    const timezone = getTimezoneString();\n\n    return {\n      utcDate,\n      utcTime,\n      localDate,\n      localTime,\n      timezone,\n    };\n  }, [timestamp]);\n\n  // Update relative times periodically\n  useEffect(() => {\n    if (!timestamp) {\n      setSimpleRelativeTime(\"\");\n      setDetailedRelativeTime(\"\");\n      return;\n    }\n\n    const updateRelativeTimes = () => {\n      const date = new Date(timestamp);\n      setSimpleRelativeTime(formatSimpleRelativeTime(date));\n      setDetailedRelativeTime(formatDetailedRelativeTime(date));\n    };\n\n    updateRelativeTimes();\n    const interval = setInterval(updateRelativeTimes, 60000); // Update every minute\n\n    return () => clearInterval(interval);\n  }, [timestamp]);\n\n  if (!timestamp || !simpleRelativeTime || !timeInfo) {\n    return null;\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger\n        className={className ?? \"cursor-default text-muted-foreground text-xs\"}\n        {...props}\n      >\n        {leading} {simpleRelativeTime}\n      </TooltipTrigger>\n      <TooltipPopup>\n        <div className=\"space-y-2 text-xs\">\n          {/* Detailed relative time at the top */}\n          <div className=\"text-left\">{detailedRelativeTime}</div>\n\n          {/* UTC and local timezone */}\n          <div className=\"space-y-1\">\n            <div className=\"flex items-center justify-between gap-4\">\n              <div className=\"flex items-center gap-1\">\n                <Badge variant=\"secondary\">UTC</Badge>\n                <div>{timeInfo.utcDate}</div>\n              </div>\n              <div className=\"text-right\">\n                <div className=\"text-muted-foreground\">{timeInfo.utcTime}</div>\n              </div>\n            </div>\n            <div className=\"flex items-center justify-between gap-4\">\n              <div className=\"flex items-center gap-1\">\n                <Badge variant=\"secondary\">{timeInfo.timezone}</Badge>\n                <div>{timeInfo.localDate}</div>\n              </div>\n              <div className=\"text-right\">\n                <div className=\"text-muted-foreground\">\n                  {timeInfo.localTime}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </TooltipPopup>\n    </Tooltip>\n  );\n};\n",
      "type": "registry:component",
      "target": "components/agent/relative-time.tsx"
    }
  ]
}