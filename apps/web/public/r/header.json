{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "header",
  "type": "registry:component",
  "title": "AgentStart Header",
  "description": "Thread header component that fetches thread metadata via oRPC and TanStack Query with rename/delete actions and timestamp display.",
  "dependencies": [
    "@phosphor-icons/react",
    "@tanstack/react-query",
    "agentstart",
    "react"
  ],
  "registryDependencies": [
    "@coss/button",
    "@coss/menu",
    "@coss/skeleton",
    "@coss/tooltip",
    "relative-time"
  ],
  "files": [
    {
      "path": "src/registry/agentstart/header.tsx",
      "content": "/* agent-frontmatter:start\nAGENT: Thread header component\nPURPOSE: Display thread title and metadata using oRPC\nUSAGE: <Header threadId={threadId} />\nEXPORTS: Header, HeaderProps, HeaderSkeleton\nFEATURES:\n  - Fetches thread data using TanStack Query and oRPC\n  - Displays thread title, visibility, and timestamps\n  - Provides loading skeleton state\n  - Error handling with retry functionality\nSEARCHABLE: thread header, thread title, thread info, orpc header\nagent-frontmatter:end */\n\n\"use client\";\n\nimport {\n  GearIcon,\n  PencilSimpleIcon,\n  PencilSimpleLineIcon,\n  TrashIcon,\n  WarningCircleIcon,\n} from \"@phosphor-icons/react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { useAgentStartContext } from \"agentstart/client\";\nimport type { ComponentProps, ReactNode } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Menu,\n  MenuGroup,\n  MenuGroupLabel,\n  MenuItem,\n  MenuPopup,\n  MenuTrigger,\n} from \"@/components/ui/menu\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { cn } from \"@/lib/utils\";\nimport { RelativeTime } from \"./relative-time\";\n\nexport type HeaderProps = ComponentProps<\"header\"> & {\n  /**\n   * Custom loading state element while fetching thread data\n   */\n  loadingState?: ReactNode;\n  /**\n   * Custom error renderer when fetching thread fails\n   */\n  errorState?: (error: Error, retry: () => void) => ReactNode;\n  /**\n   * Hide specific metadata fields\n   */\n  hideMetadata?: {\n    visibility?: boolean;\n    timestamps?: boolean;\n    userId?: boolean;\n  };\n  /**\n   * Custom element to render before the header content\n   */\n  leading?: ReactNode;\n  /**\n   * Custom element to render after the header content\n   */\n  trailing?: ReactNode;\n  /**\n   * Callback when thread is renamed\n   */\n  onRename?: (threadId: string, newTitle: string) => void;\n  /**\n   * Callback when thread is deleted\n   */\n  onDelete?: (threadId: string) => void;\n  /**\n   * Hide the settings button\n   */\n  hideSettings?: boolean;\n};\n\nexport function Header({\n  className,\n  loadingState,\n  errorState,\n  hideMetadata = {},\n  leading,\n  trailing,\n  onRename,\n  onDelete,\n  hideSettings = false,\n  ...props\n}: HeaderProps) {\n  const { orpc, threadId } = useAgentStartContext();\n\n  const { data, error, isLoading, isError, refetch } = useQuery(\n    orpc.thread.get.queryOptions({\n      input: { threadId: threadId! },\n      enabled: !!threadId,\n    }),\n  );\n  const queryClient = useQueryClient();\n\n  // Rename mutation\n  const updateMutation = useMutation(\n    orpc.thread.update.mutationOptions({\n      onSuccess: () => {\n        refetch();\n        queryClient.invalidateQueries(orpc.thread.list.queryOptions());\n      },\n    }),\n  );\n\n  // Delete mutation\n  const deleteMutation = useMutation(\n    orpc.thread.delete.mutationOptions({\n      onSuccess: () => {\n        onDelete?.(threadId!);\n      },\n    }),\n  );\n\n  if (isLoading) {\n    return loadingState ?? <HeaderSkeleton className={className} />;\n  }\n\n  if (isError && error) {\n    const defaultErrorState = (\n      <header\n        className={cn(\n          \"flex items-center justify-between gap-1 border-b bg-background px-6 py-3\",\n          className,\n        )}\n        {...props}\n      >\n        <div className=\"flex items-center gap-2 text-destructive\">\n          <WarningCircleIcon className=\"size-5\" weight=\"duotone\" />\n          <span className=\"font-medium text-sm\">Failed to load thread</span>\n        </div>\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => refetch()}\n        >\n          Retry\n        </Button>\n      </header>\n    );\n\n    return errorState?.(error, () => refetch()) ?? defaultErrorState;\n  }\n\n  if (!data?.thread) {\n    return null;\n  }\n\n  const { thread } = data;\n\n  const handleRename = () => {\n    const newTitle = window.prompt(\n      \"Enter new thread title:\",\n      thread.title ?? \"\",\n    );\n    if (newTitle?.trim() && newTitle !== thread.title) {\n      updateMutation.mutate({\n        threadId: threadId!,\n        data: { title: newTitle.trim() },\n      });\n      onRename?.(threadId!, newTitle.trim());\n    }\n  };\n\n  const handleDelete = () => {\n    if (\n      window.confirm(\n        `Are you sure you want to delete \"${thread.title ?? \"this thread\"}\"?`,\n      )\n    ) {\n      deleteMutation.mutate({ threadId: threadId! });\n    }\n  };\n\n  return (\n    <header\n      className={cn(\n        \"flex items-center justify-between gap-1 border-b bg-background px-6 py-3\",\n        className,\n      )}\n      {...props}\n    >\n      {leading}\n\n      <div className=\"flex min-w-0 flex-1 items-center gap-2\">\n        <Tooltip>\n          <TooltipTrigger\n            render={\n              <h1\n                className=\"group max-w-1/2 cursor-pointer truncate font-semibold text-base hover:underline\"\n                onClick={handleRename}\n              >\n                {thread.title}\n                <PencilSimpleLineIcon\n                  weight=\"duotone\"\n                  className=\"-mt-0.5 ml-1 inline size-4! opacity-0 group-hover:opacity-100\"\n                />\n              </h1>\n            }\n          />\n          <TooltipContent>\n            <p>Rename</p>\n          </TooltipContent>\n        </Tooltip>\n      </div>\n\n      {!hideMetadata.timestamps && (thread.updatedAt || thread.createdAt) && (\n        <div className=\"flex items-center gap-2 text-muted-foreground text-xs\">\n          <span className=\"flex items-center gap-1\">\n            <RelativeTime\n              leading={<span>{thread.updatedAt ? \"Updated\" : \"Created\"}</span>}\n              timestamp={thread.updatedAt || thread.createdAt}\n            />\n          </span>\n        </div>\n      )}\n\n      {!hideSettings && (\n        <Menu>\n          <Tooltip>\n            <MenuTrigger\n              render={\n                <TooltipTrigger\n                  render={\n                    <Button variant=\"ghost\" size=\"icon-sm\">\n                      <GearIcon weight=\"duotone\" className=\"size-4\" />\n                    </Button>\n                  }\n                />\n              }\n            />\n            <TooltipContent>\n              <span>Settings</span>\n            </TooltipContent>\n          </Tooltip>\n\n          <MenuPopup>\n            <MenuGroup>\n              <MenuGroupLabel>Thread Settings</MenuGroupLabel>\n\n              <MenuItem onClick={handleRename}>\n                <PencilSimpleIcon weight=\"duotone\" className=\"size-4.5\" />{\" \"}\n                <span>Rename</span>\n              </MenuItem>\n              <MenuItem onClick={handleDelete}>\n                <TrashIcon\n                  weight=\"duotone\"\n                  className=\"size-4.5 text-destructive\"\n                  color=\"currentColor\"\n                />{\" \"}\n                <span className=\"text-destructive\">Delete</span>\n              </MenuItem>\n            </MenuGroup>\n          </MenuPopup>\n        </Menu>\n      )}\n\n      {trailing}\n    </header>\n  );\n}\n\nexport type HeaderSkeletonProps = ComponentProps<\"header\">;\n\nexport function HeaderSkeleton({ className, ...props }: HeaderSkeletonProps) {\n  return (\n    <header\n      className={cn(\n        \"flex items-center justify-between gap-1 border-b bg-background px-6 py-3\",\n        className,\n      )}\n      {...props}\n    >\n      <div className=\"flex items-center gap-3\">\n        <Skeleton className=\"h-6 w-48\" />\n        <Skeleton className=\"h-5 w-16\" />\n      </div>\n      <div className=\"flex items-center gap-2\">\n        <Skeleton className=\"h-4 w-32\" />\n      </div>\n    </header>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/agent/header.tsx"
    }
  ]
}